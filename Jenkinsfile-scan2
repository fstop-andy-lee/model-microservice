pipeline {
    
    agent {
        label "podman-agent"
    }
    
    tools {
        maven "Maven 3"
    }
    
    environment {
        REGISTRY = "harbor.fstop.com.tw"
        NAMESPACE = "model-microservice"
        IMAGE_NAME= "swift-messaging"
        CREDENTIALSID = ""
    }
    
    stages {
        
        stage("Checkout Source") {
            steps {             
                git branch: 'develop', url: 'https://github.com/fstop-andy-lee/model-microservice.git'        
            }
        }
        
        stage("Sonarqbue Analysis") {
            steps {
                sh """
                    #!/bin/bash
                    mvn clean package -DskipTest
                    mvn clean verify sonar:sonar \
                    -Dsonar.projectKey=swift-messaging \
                    -Dsonar.host.url=http://sonarqube.fstop.com.tw:9000 \
                    -Dsonar.login=sqp_1e8457d2c81bfd5e3ff96d516c4463a26de88aba
                """
            }
        }
        
        
        
    }
}
